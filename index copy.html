<html>
  <head>
    <title>2022 FE Îç∞Î∏åÎß§Ïπ≠</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main class="App">
      <div class="SelectedLanguage">
        <!-- <ul>
          <li>JavaScript</li>
          <li>Python</li>
          <li>Elixir</li>
          <li>Java</li>
          <li>PHP</li>
        </ul> -->
      </div>
      <form class="SearchInput">
        <input
          class="SearchInput__input"
          type="text"
          placeholder="ÌîÑÎ°úÍ∑∏Îû® Ïñ∏Ïñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî."
          value=""
          data-items="[]"
        />
      </form>
      <div class="Suggestion">
        <!-- <ul>
          <li class="Suggestion__item--selected">Action<span class="Suggestion__item--matched">Script</span></li>
          <li>Java<span class="Suggestion__item--matched">Script</span></li>
          <li>Type<span class="Suggestion__item--matched">Script</span></li>
          <li>Pure<span class="Suggestion__item--matched">Script</span></li>
        </ul> -->
      </div>
    </main>
    <script>
      let state = {
        items: ["JavaScript", "Python", "Elixir", "Java", "PHP"],
      };

      let searchList = [];
      let rowIndex = 0;

      const selectedLanguage = document.querySelector(".SelectedLanguage");
      const suggestion = document.querySelector(".Suggestion");
      const form = document.querySelector(".SearchInput");
      const searchInput = document.querySelector(".SearchInput__input");
      // const results = document.querySelectorAll('')

      suggestion.style.display = "none";
      searchInput.focus();

      const setState = (newState) => {
        state = { ...state, ...newState };
        render();
      };

      const fetchData = async (keyword) => {
        try {
          const url =
            "https://wr4a6p937i.execute-api.ap-northeast-2.amazonaws.com/dev";
          const option = {
            method: "get",
            headers: { "Content-Type": "application/json" },
          };
          const response = await fetch(
            `${url}/languages?keyword=${keyword}`,
            option
          );
          const data = await response.json();
          return data;
        } catch (e) {
          throw e;
        }
      };

      form.onsubmit = (e) => {
        console.log("e >>", e.key);

        e.preventDefault();
      };
      searchInput.onkeyup = async ({ target: { value }, key }) => {
        // const { value } = e.target;
        // console.log('e >>', e.key)

        if (value) {
          // setState({ results: await fetchData(value) })
          searchList = await fetchData(value);
          // if ( key === 'ArrowUp') {
          //   if(rowIndex === 0) {
          //     rowIndex = searchList.length - 1;
          //   } else {
          //     rowIndex++;
          //   }
          // }
          // if (key === 'ArrowDown') {
          //   if(rowIndex === searchList.length - 1) {
          //     rowIndex = 0;
          //   } else {
          //     rowIndex--;
          //   }
          // }
          const highLightSearchList = (searchList || []).map((item) => [
            item.split(""),
            item
              .split("")
              .map((text) => value.toLowerCase().includes(text.toLowerCase())),
          ]);
          // const highLightSearchList = (searchList || []).map(item => ({text : item.split(''), isHighLight : item.split('').map(text => value.toLowerCase().includes(text.toLowerCase()))}));
          // const highLightSearchList = (searchList || []).map(item => item.split('').map(text => ({text, isHighLight : value.toLowerCase().includes(text.toLowerCase())}) ))
          // console.log('highLightSearchList >>',highLightSearchList.map((text) => console.log('text >>>', text)));

          if (
            (key === "ArrowUp" || key === "ArrowDown") &&
            searchList.length > 0
          ) {
            searchInput.blur();
            return;
          }

          const test = searchList.map((item) =>
            item.toLowerCase().split(value.toLowerCase())
          );
          console.log(
            "üöÄ ~ file: index.html ~ line 124 ~ searchInput.onkeyup= ~ value.toLowerCase()",
            value.toLowerCase()
          );
          console.log(
            "üöÄ ~ file: index.html ~ line 132 ~ searchInput.onkeyup= ~ test",
            test
          );

          // console.log(
          //   "text >>>",
          //   searchList.map((item) =>
          //     item
          //       .toLowerCase()
          //       .split(value.toLowerCase())
          //       .map((text) => (text ? text : value.toLowerCase()))
          //   )
          // );
          suggestion.innerHTML = `
            <ul>
              ${highLightSearchList
                .map((text, idx) => {
                  // console.log(item.toLowerCase().indexOf(value.toLowerCase()));
                  // const matchTextNum = item.toLowerCase().indexOf(value.toLowerCase());

                  // const isHighLight = item.split('').map(text => value.includes(text))
                  // console.log("text.join() >>", text);

                  // const stringVal = "Hello world",
                  // exp = /value/;
                  // exp.test(stringVal );

                  // console.log(item.toLowerCase().split(value.toLowerCase()).map(text => text ? text : value.toLowerCase()))
                  // console.log(item.toLowerCase().split(value.toLowerCase()).map(text => text ? text : value.toLowerCase()))
                  // console.log(item.split(value))
                  // <span class="${isHighLight.map(bool => bool ? 'Suggestion__item--matched' : '')}">${text.join('')}</span>
                  // <span class="${isHighLight.map(bool => bool ? 'Suggestion__item--matched' : '')}">${text.join('')}</span>
                  // ${isHighLight.foreach((_,index) => `<span class="${isHighLight[index] ? 'Suggestion__item--matched' : ''}">${text.join('')}</span>`)}

                  const a = text[0]
                    .map(
                      (list, index) => `
                    <span class="${
                      text[1][index] ? "Suggestion__item--matched" : ""
                    }" >${list}</span>
                  `
                    )
                    .join("");

                  return `
                  <li class="${
                    rowIndex === Number(idx) ? "Suggestion__item--selected" : ""
                  }">
                    ${text[0]
                      .map(
                        (list, index) => `
                    <span class="${
                      text[1][index] ? "Suggestion__item--matched" : ""
                    }" >
                    ${list}
                    </span>
                  `
                      )
                      .join("")}
                  </li>`;
                })
                .join("")}
            </ul>
          `;

          if (searchList.length > 0) {
            suggestion.style.display = "block";
          } else {
            suggestion.style.display = "none";
          }
        } else {
          suggestion.style.display = "none";
        }
      };

      const render = () => {
        const { items } = state;
        selectedLanguage.innerHTML = `
          <ul>
            ${items.map((item) => `<li>${item}</li>`).join("")}
          </ul>
        `;
        // document.querySelector('#append').addEventListener('click', () => {
        //   setState({ items: [ ...items, `item${items.length + 1}` ] })
        // })
      };

      render();
    </script>
  </body>
</html>
